-- This script was generated by the ERD tool in pgAdmin 4.
-- Please log an issue at https://github.com/pgadmin-org/pgadmin4/issues/new/choose if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE IF NOT EXISTS public.cliente
(
    id SERIAL PRIMARY KEY,
    nome character varying(100) NOT NULL,
    cpf character varying(11)
);

CREATE TABLE IF NOT EXISTS public.estado
(
    sigla character varying(2) NOT NULL,
    nome character varying(50) NOT NULL,
    PRIMARY KEY (sigla)
);

CREATE TABLE IF NOT EXISTS public.endereco
(
    id SERIAL PRIMARY KEY,
    id_cliente integer NOT NULL,
    rua character varying(50),
    numero integer,
    cidade character varying(50) NOT NULL,
    estado character varying(2) NOT NULL,
    complemento character varying(50),
    cep character varying(8)
);

CREATE TABLE IF NOT EXISTS public.cabine
(
    id SERIAL PRIMARY KEY,
    altura integer NOT NULL,
    descricao character varying(50) NOT NULL
);

CREATE TABLE IF NOT EXISTS public.contrato
(
    id SERIAL PRIMARY KEY,
    data_venda date,
    data_entrega date,
    id_cliente integer
);

CREATE TABLE IF NOT EXISTS public.elevador
(
    id SERIAL PRIMARY KEY,
    id_contrato integer,
    id_cabine integer NOT NULL,
    elevacao integer NOT NULL,
    cor character varying(20)
);

ALTER TABLE IF EXISTS public.endereco
    ADD FOREIGN KEY (id_cliente)
    REFERENCES public.cliente (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE
    NOT VALID;


ALTER TABLE IF EXISTS public.endereco
    ADD FOREIGN KEY (estado)
    REFERENCES public.estado (sigla) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.elevador
    ADD FOREIGN KEY (id_cabine)
    REFERENCES public.cabine (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public.elevador
    ADD FOREIGN KEY (id_contrato)
    REFERENCES public.contrato (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE SET NULL
    NOT VALID;


ALTER TABLE IF EXISTS public.contrato
    ADD FOREIGN KEY (id_cliente)
    REFERENCES public.cliente (id) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE
    NOT VALID;

END;